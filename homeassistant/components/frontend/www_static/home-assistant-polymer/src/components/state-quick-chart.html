<link rel="import" href="../../bower_components/polymer/polymer.html">
<script src="../../bower_components/chart.js/dist/Chart.js"></script>
<script src="../../bower_components/moment/min/moment.min.js"></script>


<dom-module id="state-quick-chart">

  <template>
    <style>
        .chart-container {
          padding: 20px;
        }
    </style>
    <div class="chart-container">
      <canvas id="canvas" width="600" height="400"></canvas>
    </div>

  </template>

</dom-module>

<script>
(function () {
  'use strict';

  Polymer({
    is: 'state-quick-chart',

    properties: {
      chartType: {
        type: String,
        value: ""
      },

      chartLabel: {
        type: String,
        value: ""
      },

      unit: {
        type: String,
      },

      isAttached: {
        type: Boolean,
        value: false
      },

      chartEngine: {
        type: Object,
      },

      _apiLoaded: {
        type: Boolean,
        value: false,
      },

      chartData: {
        type: Object,
        value: {},
        observer: 'dataChanged'
      },
    },

    created: function () {
      this.style.display = 'block';
    },

    attached: function () {
      this.isAttached = true;
    },

    dataChanged: function (chartData) {
      if (chartData)
      {
        // this.drawChart();
        switch (this.chartType)
        {
          case 'line':
            this.drawChartLine(chartData);
            break;
        }
      }
    },

    drawChartLine: function (data) {
      var ctx = this.$.canvas.getContext('2d');
      var myChart = new Chart(ctx, {
          type: 'line',
          data: {
              labels: data.times.map(function (timeStamp, index) {
                let timeLabel = '';
                if (index % 2 === 0)
                {
                  timeLabel = moment(timeStamp).format('h:mm a');
                }
                return timeLabel;
              }),
              datasets: [
                {
                    label: 'historical',
                    data: data.historical,
                    backgroundColor: 'gray',
                    borderColor: 'gray',
                    lineTension: 0,
                    fill: false
                },{
                    label: 'actual',
                    data: data.actual,
                    backgroundColor: 'orange',
                    borderColor: 'orange',
                    lineTension: 0,
                    fill: false
                },{
                    label: 'transactive',
                    data: data.transactive,
                    backgroundColor: 'orange',
                    borderColor: 'orange',
                    lineTension: 0,
                    borderDash: [5, 5],
                    fill: false
                }
              ]
          },
          options: {
              scales: {
                  yAxes: [{
                      ticks: {
                          beginAtZero:true
                      }
                  }]
              }
          }
      });
    },


  });
}());
</script>
