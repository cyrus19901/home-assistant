<link rel="import" href="../../bower_components/polymer/polymer.html">

<script>
(function () {
  'use strict';

  Polymer({
    is: 'state-quick-chart',

    properties: {
      chartType: {
        type: String,
        value: ""
      },

      chartLabel: {
        type: String,
        value: ""
      },

      unit: {
        type: String,
      },

      isAttached: {
        type: Boolean,
        value: false
      },

      chartEngine: {
        type: Object,
      },

      _apiLoaded: {
        type: Boolean,
        value: false,
      },

      chartData: {
        type: Array,
        value: [],
        observer: 'dataChanged'
      },
    },

    created: function () {
      this.style.display = 'block';
    },

    attached: function () {
      this.isAttached = true;
    },

    dataChanged: function (chartData) {
      if (chartData)
      {
        switch (this.chartType)
        {
          case 'bar':
            this.drawChartBar(chartData);
            break;
          case 'line':
            this.drawChartLine(chartData);
            break;
        }
      }
    },

    drawChartBar: function (dataPoints) {

      var data = new window.google.visualization.DataTable();

      data.addColumn('datetime', 'X');
      data.addColumn('number', 'Device1');
      data.addColumn('number', 'Device2');
      data.addColumn('number', 'Device3');

      const dataRows = dataPoints.map(function (array) {

        const newArray = array.map(function (item, index) {

          if (index === 0)
          {
            return new Date(item);
          }
          else 
          {
            return item;
          }
        });
        return newArray;
      });

      data.addRows(dataRows);


      var options = {
        legend: { position: 'top'},
        bar: { groupWidth: "80%"},
        isStacked: true,
        title:'Overall Power for individual devices',
        series: {
          1: {curveType: 'function'}
        }
      };

      if (!this.chartEngine) {
        this.chartEngine = new window.google.visualization.ColumnChart(this);
      }

      this.chartEngine.draw(data, options);     
    },



    drawChartLine: function (dataPoints) {
      var data = new window.google.visualization.DataTable();

      data.addColumn('datetime', 'X');
      data.addColumn('number', this.chartLabel);

      const dataRows = dataPoints.map(function (array) {

        const newArray = array.map(function (item, index) {

          if (index === 0)
          {
            return new Date(item);
          }
          else 
          {
            return item;
          }
        });
        return newArray;
      });

      data.addRows(dataRows);

      var options = {
        legend: { position: 'top'},
        lineWidth: 2,
        title:'Overall Energy for all devices',
        series: {
          1: {curveType: 'function'}
        }
      };

      if (!this.chartEngine) {
        this.chartEngine = new window.google.visualization.LineChart(this);
      }

      this.chartEngine.draw(data, options);
    },


  });
}());
</script>
