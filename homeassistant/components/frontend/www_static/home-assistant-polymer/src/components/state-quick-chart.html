<link rel="import" href="../../bower_components/polymer/polymer.html">

<script>
(function () {
  'use strict';

  Polymer({
    is: 'state-quick-chart',

    properties: {
      chartType: {
        type: String,
        value: ""
      },

      chartLabel: {
        type: String,
        value: ""
      },

      unit: {
        type: String,
      },

      isAttached: {
        type: Boolean,
        value: false
      },

      chartEngine: {
        type: Object,
      },

      _apiLoaded: {
        type: Boolean,
        value: false,
      },

      chartData: {
        type: Array,
        value: [],
        observer: 'dataChanged'
      },
    },

    created: function () {
      this.style.display = 'block';
      // this.style.width = 'block';
      // this.style.display = 'block';
    },

    attached: function () {
      this.isAttached = true;
    },

    dataChanged: function (chartData) {
      if (chartData)
      {
        switch (this.chartType)
        {
          case 'line':
            this.drawChartBar(chartData);
            break;
          case 'bar':
            this.drawChartLine(chartData);
            break;
        }
      }
    },

    drawChartBar: function (dataPoints) {
      var data = new window.google.visualization.DataTable();

      data.addColumn('datetime', 'X');
      data.addColumn('number', 'Device1');
      data.addColumn('number', 'Device2');
      data.addColumn('number', 'Device3');


      data.addRows([dataPoints].map(function (array) {
        const newArray = array.map(function (item, index) {
          if (index === 0)
          {
            return new Date(item);
          }
          else 
          {
            return item;
          }
        });
        return newArray;
      }));

      var options = {
        title:'Overall Power for individual devices',
        series: {
          1: {curveType: 'function'}
        }
      };

      if (!this.chartEngine) {
        this.chartEngine = new window.google.visualization.ColumnChart(this);
      }

      this.chartEngine.draw(data, options);     
    },
    drawChartLine: function (dataPoints) {
      var data = new window.google.visualization.DataTable();

      data.addColumn('datetime', 'X');
      data.addColumn('number', 'Device1');
      data.addColumn('number', 'Device2');
      data.addColumn('number', 'Device3');
      data.addRows([dataPoints].map(function (array) {
        const newArray = array.map(function (item, index) {
          if (index === 0)
          {
            return new Date(item);
          }
          else 
          {
            return item;
          }
        });
        return newArray;
      }));

      var options = {
        legend: { position: 'right', maxLines: 3 },
        bar: { groupWidth: '20%' },
        isStacked: true,
        title:'Overall Energy for individual devices',
        series: {
          1: {curveType: 'function'}
        }
        // hAxis: {
        //   ticks: [2,4,6,8,10,12,14,16,18,20,22,24]
        // }
      };

      if (!this.chartEngine) {
        this.chartEngine = new window.google.visualization.ColumnChart(this);
      }

      this.chartEngine.draw(data, options);
    },
  });
}());
</script>
