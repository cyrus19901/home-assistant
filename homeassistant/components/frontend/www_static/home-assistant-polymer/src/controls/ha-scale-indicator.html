<link rel='import' href='../../bower_components/polymer/polymer.html'>
<link rel="import" href="../../bower_components/paper-material/paper-material.html">

<dom-module id='ha-scale-indicator'>
  <template>
    <style include="paper-material">
      :host {
        display: block;
        border-radius: 2px;
        transition: all 0.30s ease-out;
        padding:0 6px 0 6px;
        background-color: white;
      }
      .scale-indicator {
        width: 100%;
        height: 100px;
        position: relative;
      }
      .left-end,
      .right-end {
        position: absolute;
        font-size: 12px;
        bottom: 0;
      }
      .left-end,
      .left-icon {
        left: 0;
      }
      .right-end,
      .right-icon {
        right: 0;
      }
      .left-icon,
      .right-icon {
        position: absolute;
        font-size: 12px;
        top: 0;
        color: darkgray;
      }
      .actual-value,
      .pointer-marker {
        text-align: center;
        font-size: 14px;
        color: forestgreen;
      }
      .description {
        font-size: 12px;
        color: forestgreen;
      }
      .indicator-line {
        margin: 10px 0;
        height: 2px;
        width: 100%;
        border: solid gray 1px;
        box-sizing: border-box;
      }
    </style>
    <div class='description'>[[description]]</div>
    <div class='scale-indicator'>
      <div class='left-icon'>
        <iron-icon icon="[[left_icon]]"></iron-icon>
      </div>
      <div class='right-icon'>
        <iron-icon icon="[[right_icon]]"></iron-icon>
      </div>
      <div class='left-end'>[[left_label]]</div>
      <div class='right-end'>[[right_label]]</div>
      <div class='actual-value'>[[actual_label]]</div>
      <div class='indicator-line'></div>
      <div class='pointer-marker'><iron-icon icon="mdi:triangle"></iron-icon></div>
    </div>
  </template>
</dom-module>

<script>
Polymer({
  is: 'ha-scale-indicator',

  properties: {
    hass: {
      type: Object,
    },
    left_icon: {
      type: String
    },
    right_icon: {
      type: String
    },
    left_end: {
      type: Number
    },
    left_label: {
      type: String
    },
    right_end: {
      type: Number
    },
    right_label: {
      type: String
    },
    actual_value: {
      type: Number
    },
    actual_label: {
      type: String
    },
    description: {
      type: String
    }
  },
  computeLeft: function (min) {
    const componentWidth = 168;
    const left = min * componentWidth / 100 + 15;
    return `${left}px`;
  },
  computeWidth: function (max, min) {
    const componentWidth = 168;
    const width = (max - min) * componentWidth / 100;
    return `${width}px`;
  },
  updateSliderValue: function (evt) {
    
    if (evt.target)
    {
      const newValue = evt.target.value;

      console.log('we are updating ' + newValue);

      this.doUpdateTransactiveHome({ 'target': 'flexibility', 'value': newValue });
    }
  },

  doUpdateTransactiveHome: function (value) {
    console.log(value);
    this.callServiceHelper('update_transactive_home', value);
  },

  callServiceHelper: function (service, data) {
    // We call stateChanged after a successful call to re-sync the inputs
    // with the state. It will be out of sync if our service call did not
    // result in the entity to be turned on. Since the state is not changing,
    // the resync is not called automatic.
    /* eslint-disable no-param-reassign */
    // data.entity_id = this.stateObj.entity_id;
    /* eslint-enable no-param-reassign */
    console.log('in call service helper');
    if (this.hass)
    { console.log(service);
      console.log(data);     
      this.hass.callService('transactive_home', service, { value: data})
        .then(function () {
          // this.stateObjChanged(this.stateObj);
          console.log('successful service call');
        }.bind(this));
    }
  },
});


</script>
